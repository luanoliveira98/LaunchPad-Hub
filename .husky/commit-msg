#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# 1. Checks the commit message (Fast)
echo "ğŸ“ Validating commit message..."
./node_modules/.bin/commitlint --edit "$1" || exit 1

# 2. If the message passed, now we run the tests (Slow)
echo "ğŸ§ª Message valid! Running quality checks..."

STAGED_DIRS=$(git diff --cached --name-only | cut -d/ -f1-3 | sort -u)

for DIR in $STAGED_DIRS; do
  if [ -f "$DIR/package.json" ]; then
    bash "./tooling/verify-quality.sh" "$DIR" || exit 1
  fi
done

if git diff --cached --name-only | grep -qv "/"; then
    bash "./tooling/verify-quality.sh" "." || exit 1
fi

echo "âœ… All checks passed. Commit created!"